name: ğŸ” Pre-Integration Checks

on:
  pull_request:
  push:
    branches:
      - main
  schedule:
    - cron: '0 9 * * *' # every day at 9:00

jobs:
  git-checks:
    name: ğŸš¦ Git Checks
    uses: ./.github/workflows/git.yaml

  build-checks:
    name: ğŸ—ï¸ Build Checks
    uses: ./.github/workflows/build.yaml

  post-reviews:
    name: ğŸ“„ Post Reviews
    uses: ./.github/workflows/review.yaml

  lint:
    name: ğŸ” Code Quality Checks
    uses: ./.github/workflows/lint.yaml

  test:
    name: ğŸ§ª Tests
    uses: ./.github/workflows/test.yaml

  code-quality-evaluation:
    name: ğŸ” Code Quality Checks evaluation
    runs-on: ubuntu-24.04
    needs: [lint, test, post-reviews]
    if: always()
    steps:
      - name: Evaluate results of dependency jobs
        if:
          ${{ contains(needs.*.result, 'failure') || contains(needs.*.result,
          'cancelled') || contains(needs.*.result, 'skipped') }}
        run: echo "Dependency checks failed!" && exit 1

      - name: Checks passed successfully
        if: ${{ success() }}
        run: echo "All dependency checks passed successfully!"

  ready-to-merge:
    name: ğŸš¢ Ready to merge
    runs-on: ubuntu-24.04
    needs: [git-checks, build-checks, code-quality-evaluation]
    if: always()
    steps:
      - name: Evaluate results of dependency jobs
        if:
          ${{ contains(needs.*.result, 'failure') || contains(needs.*.result,
          'cancelled') || contains(needs.*.result, 'skipped') }}
        run: echo "Mandatory PR checks failed!" && exit 1

      - name: Checks passed successfully
        if: ${{ success() }}
        run: echo "All automatic PR checks passed successfully!"
